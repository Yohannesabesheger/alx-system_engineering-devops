#!/usr/bin/env bash
# Configures Nginx to include X-Served-By header with the server hostname

# Exit on error
set -e

# Install Nginx if not installed
apt-get update -y
apt-get install -y nginx

# Get server hostname
HOSTNAME=$(hostname)

# Backup original config
CONFIG_FILE="/etc/nginx/sites-available/default"
cp "$CONFIG_FILE" "$CONFIG_FILE.bak"

# Ensure add_header line is added only once
grep -q "add_header X-Served-By" "$CONFIG_FILE" || \
sed -i "/location \/ {/a \        add_header X-Served-By $HOSTNAME;" "$CONFIG_FILE"

# Restart Nginx
systemctl restart nginx
