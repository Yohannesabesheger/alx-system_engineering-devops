#!/usr/bin/env bash
# Configures Nginx on a fresh Ubuntu server to include a custom X-Served-By header

# Install Nginx
apt-get update -y
apt-get install -y nginx

# Get the server's hostname
HOSTNAME=$(hostname)

# Add the custom header in the Nginx default config
# This will be inside the server block, so we insert it before the closing '}' in location /
CONFIG_FILE="/etc/nginx/sites-available/default"

# Backup the original config file before modifying
cp "$CONFIG_FILE" "$CONFIG_FILE.bak"

# Update config to include custom header
sed -i "/location \/ {/a \        add_header X-Served-By $HOSTNAME;" "$CONFIG_FILE"

# Restart Nginx to apply changes
systemctl restart nginx
